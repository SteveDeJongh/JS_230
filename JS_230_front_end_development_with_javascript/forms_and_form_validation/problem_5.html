<!DOCTYPE html>
<html>
  <head>
    <title>Multiple Choice Quiz</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/handlebars.js/4.0.5/handlebars.js"></script>
    <script>
      const questions = [
        {
          id: 1,
          description: "Who is the author of <cite>The Hitchhiker's Guide to the Galaxy</cite>?",
          options: ['Dan Simmons', 'Douglas Adams', 'Stephen Fry', 'Robert A. Heinlein'],
        },
        {
          id: 2,
          description: 'Which of the following numbers is the answer to Life, the \
                        Universe and Everything?',
          options: ['66', '13', '111', '42'],
        },
        {
          id: 3,
          description: 'What is Pan Galactic Gargle Blaster?',
          options: ['A drink', 'A machine', 'A creature', 'None of the above'],
        },
        {
          id: 4,
          description: 'Which star system does Ford Prefect belong to?',
          options: ['Aldebaran', 'Algol', 'Betelgeuse', 'Alpha Centauri'],
        },
      ];
      
      const answerKey = { '1': 'Douglas Adams', '2': '42', '3': 'A drink', '4': 'Betelgeuse' };
      
      document.addEventListener('DOMContentLoaded', e => {
        let quiz = {
          quiz_Template: document.querySelector('#question_template'),
          fieldSet: document.querySelector('#quizForm > fieldset'),
          submitButton: document.querySelector('#submit'),
          resetButton: document.querySelector('#reset'),
          form: document.querySelector('#quizForm'),

          renderQuestions() {
            let quizTempFunc = Handlebars.compile(this.quiz_Template.innerHTML);

            this.fieldSet.insertAdjacentHTML('afterbegin', quizTempFunc({qGroup: questions}));
          },

          formDataToHash(data) {
            let answers = {};

            for (const [k, v] of data) {
              answers[k.split('_')[1]] = v;
            };

            return answers;
          },

          updateQuestionStatus(answers) {
            let questions = document.querySelectorAll('.question');

            questions.forEach(q => {
              let questionAnswer = answers[q.id];
              if (answerKey[q.id] === questionAnswer) {
                this.markCorrect(q)
              } else if (!questionAnswer) {
                this.markIncorrect(q, `You did not answer the question. The correct answer is: ${answerKey[q.id]}.`);
              } else {
                this.markIncorrect(q, `That is incorrect. The correct answer is: ${answerKey[q.id]}.`);
              }
            })
          },

          markCorrect(q) {
            let span = q.querySelector(`#status${q.id}`);

            span.classList.add('correct');
            span.textContent = "Correct Answer";
          },

          markIncorrect(q, reason) {
            let span = q.querySelector(`#status${q.id}`);

            span.classList.add('incorrect');
            span.textContent = reason;
          },

          resetQuestion(q) {
            let span = q.querySelector(`#status${q.id}`);

            span.classList.remove('correct');
            span.classList.remove('incorrect');
            span.textContent = '';
          },

          formSubmit(e) {
            e.preventDefault();
            this.submitButton.disabled = true;

            let answers = this.formDataToHash(new FormData(this.form));
            
            this.updateQuestionStatus(answers);
          },

          formReset(e) {
            let questions = document.querySelectorAll('.question');

            questions.forEach(q => {
              this.resetQuestion(q);
            });
            this.submitButton.disabled = false;
          },

          bindEvents() {
            this.form.addEventListener('submit', this.formSubmit.bind(this));
            this.form.addEventListener('reset', this.formReset.bind(this));
          },

          init() {
            this.renderQuestions();
            this.bindEvents();
          },
        }

      quiz.init();
      });
    </script>
    <style>
      .incorrect {
        border: 2px red solid;
        color: red;
      }

      .correct {
        border: 2px green solid;
        color: green;
      }
    </style>
  </head>
  <body>
    <h1>Multiple Choice Quiz</h1>
    <form id="quizForm" action="#" method="POST">
      <fieldset>

      </fieldset>
      <button id="submit" type="submit" name="submit">Submit</button>
      <button id="reset" type="reset" name="reset">Reset</button>
    </form>
  </body>

  <script id="question_template" type="text/x-handlebars">
    {{#each qGroup}}
    <p id="{{id}}" class="question">
      <label for="{{id}}">Q{{id}}. {{{description}}}</label><br>
      {{#each options}}
        <label>  
        <input type="radio" value="{{this}}" name="answer_{{../id}}">
        {{this}}</label><br>
      {{/each}}
      <br>
      <span id="status{{id}}" class=""></span><br>
    </p>
    {{/each}}
  </script>

</html>